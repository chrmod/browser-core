<?xml version="1.0"?>
<!--
	IMPORTANT !!!

	Change version in browser.css of all -moz-binding if this file
	is changed to force its refresh between updates

-->
<bindings id="cliqzBindings"
          xmlns="http://www.mozilla.org/xbl"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:xbl="http://www.mozilla.org/xbl">

  <binding id="autocomplete-rich-result-popup-cliqz" extends="chrome://global/content/bindings/autocomplete.xml#autocomplete-rich-result-popup">
    <content ignorekeys="true" level="top" consumeoutsideclicks="false">
        <xul:vbox flex="1">
          <xul:richlistbox anonid="richlistbox" class="autocomplete-richlistbox" flex="1"/>
          <xul:vbox height="1px" style="background-color: #e0e0e0; overflow: hidden;">
            <xul:resizer dir="bottom" height="1px" style="cursor: s-resize;"
              oncommand="CLIQZ.Utils.cliqzPrefs.setIntPref('popupHeight', CLIQZ.Core.popup.height); "/>
          </xul:vbox>
        </xul:vbox>
    </content>

    <implementation >
      <method name="_openAutocompletePopup">
        <parameter name="aInput"/>
        <parameter name="aElement"/>
        <body>
          <![CDATA[
          if (!this.mPopupOpen) {
            this.mInput = aInput;
            // clear any previous selection, see bugs 400671 and 488357
            this.selectedIndex = -1;

            var width = aElement.getBoundingClientRect().width;
            this.setAttribute("width", width > 100 ? width : 100);
            // invalidate() depends on the width attribute
            this._invalidate();

            // CLIQZ START

            CLIQZ.Core.popupEvent(true);

            this.openPopup(aElement, "after_start", 0, 0, false, true);
            //this.moveTo(window.screenX + 35, window.screenY + 88);

            // THIS IS NOT WORKING :(
            //this.sizeTo(window.outerWidth,500)

            // CLIQZ END
          }
        ]]>
        </body>
      </method>

      <method name="_appendCurrentResult">
        <body>
          <![CDATA[
            CLIQZ.Components._appendCurrentResult(this);
          ]]>
        </body>
      </method>
    </implementation>
  </binding>

  <binding id="autocomplete-richlistbox-cliqz" extends="chrome://global/content/bindings/richlistbox.xml#richlistbox">
    <content>
      <children includes="listheader"/>
      <xul:scrollbox allowevents="true" orient="vertical" anonid="main-box"
                     flex="1" style="overflow: auto;" xbl:inherits="dir,pack">
        <xul:vbox>
          <children/>
        </xul:vbox>

        <xul:hbox flex="1" class="cliqz-ac-engine-container">
          <xul:hbox class="cliqz-ac-engine-source">
          </xul:hbox>
          <xul:hbox flex="1" onclick="CLIQZ.Components.engineClick(event);" >
            <html:span></html:span>
            <xul:hbox anonid="engines-core"></xul:hbox>
            <xul:spacer class="cliqz-separator-engines"/>
            <xul:hbox anonid="engines-others"></xul:hbox>
          </xul:hbox>
        </xul:hbox>
      </xul:scrollbox>
    </content>
    <implementation>
      <constructor>
        <![CDATA[
          var core = document.getAnonymousElementByAttribute(this, "anonid", "engines-core"),
              others = document.getAnonymousElementByAttribute(this, "anonid", "engines-others");

          CLIQZ.Components.cliqzCreateSearchOptionsItem(core, others);
        ]]>
      </constructor>
    </implementation>
    <handlers>
      <handler event="mouseup">
        <![CDATA[
        // don't call onPopupClick for the scrollbar buttons, thumb, slider, etc.
        var item = event.originalTarget;

        while (item && item.localName != "richlistitem")
          item = item.parentNode;

        if (!item)
          return;

        // CLIQZ START
        if(event.metaKey || event.ctrlKey){
          CLIQZ.Utils.navigateToItem(
                    gBrowser,
                    0,
                    item,
                    'result_click',
                    true
                );
        }
        else {
          this.parentNode.parentNode.onPopupClick(event);
          CLIQZ.Core.popupClick(item);
        }
        // CLIQZ END
      ]]>
      </handler>
    </handlers>
  </binding>

   <binding id="autocomplete-richlistitem-cliqz" extends="chrome://global/content/bindings/autocomplete.xml#autocomplete-richlistitem">
    <content>
      <xul:hbox>
        <xul:vbox>
          <xul:hbox class="cliqz-ac-source-icon" anonid="source">
          </xul:hbox>
        </xul:vbox>
        <xul:stack>
          <xul:hbox class="cliqz-image-box">
            <xul:image anonid="cliqz-image" />
          </xul:hbox>
          <xul:hbox right="0" bottom="0" class="hidden">
            <xul:description anonid="cliqz-image-desc" class="cliqz-image-desc" />
          </xul:hbox>
        </xul:stack>
        <xul:vbox flex="1">
          <xul:hbox align="center" class="ac-title-box" >
            <xul:spacer class="cliqz-left-separator"/>
            <xul:description anonid="cliqz-title-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
            <xul:hbox anonid="title-box" class="ac-title" flex="1"
                      onunderflow="_doUnderflow('_title');"
                      onoverflow="_doOverflow('_title');">
              <xul:description anonid="title" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:label anonid="title-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-comment"/>
            <xul:hbox anonid="extra-box" class="ac-extra" align="center" hidden="true">
              <xul:image class="ac-result-type-tag"/>
              <xul:label class="ac-normal-text ac-comment" xbl:inherits="selected" value=":"/>
              <xul:description anonid="extra" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:image anonid="type-image" class="ac-type-icon"/>
          </xul:hbox>
          <xul:hbox align="center" class="ac-url-box">
            <xul:spacer class="cliqz-left-separator" anonid="url-type"/>

            <xul:hbox anonid="url-box" class="ac-url" flex="1"
                      onunderflow="_doUnderflow('_url');"
                      onoverflow="_doOverflow('_url');">
              <xul:description anonid="url" class="ac-normal-text ac-url-text"
                               xbl:inherits="selected type"/>
              <xul:description anonid="cliqz-url-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
              <xul:spacer class="cliqz-separator-10"/>
              <xul:description anonid="action" class="ac-normal-text ac-action-text"
                               xbl:inherits="selected type"/>
            </xul:hbox>
            <xul:label anonid="url-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-url-text"/>
            <xul:spacer class="ac-type-icon"/>
          </xul:hbox>
        </xul:vbox>
        <xul:vbox class="button-cliqz">
          <xul:hbox class="cliqz-ac-logo-icon" anonid="logo">
          </xul:hbox>
        </xul:vbox>
      </xul:hbox>
    </content>
  </binding>

  <binding id="button-cliqz"
           extends="chrome://global/content/bindings/button.xml#button">
    <handlers>
      <handler event="mouseup">
        <![CDATA[
          CLIQZ.Utils.navigateToItem(
                    gBrowser,
                    0,
                    event.originalTarget.parentNode.parentNode,
                    'result_click',
                    true
                );
          event.preventDefault();
          event.stopPropagation()
        ]]>
      </handler>
    </handlers>
  </binding>


  <binding id="autocomplete-richlistitem-cliqz-nologo" extends="chrome://cliqz/content/components.xml#autocomplete-richlistitem-cliqz">
    <content>
      <xul:hbox>
        <xul:vbox>
          <xul:hbox class="cliqz-ac-source-icon" anonid="source">
          </xul:hbox>
        </xul:vbox>
        <xul:stack>
          <xul:hbox class="cliqz-image-box">
            <xul:image anonid="cliqz-image" />
          </xul:hbox>
          <xul:hbox right="0" bottom="0" class="hidden">
            <xul:description anonid="cliqz-image-desc" class="cliqz-image-desc" />
          </xul:hbox>
        </xul:stack>
        <xul:vbox flex="1">
          <xul:hbox align="center" class="ac-title-box" >
            <!--
            <xul:image xbl:inherits="src=image" class="ac-site-icon"/>
            -->
            <xul:spacer class="cliqz-left-separator"/>
            <xul:description anonid="cliqz-title-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
            <xul:hbox anonid="title-box" class="ac-title" flex="1"
                      onunderflow="_doUnderflow('_title');"
                      onoverflow="_doOverflow('_title');">
              <xul:description anonid="title" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:label anonid="title-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-comment"/>
            <xul:hbox anonid="extra-box" class="ac-extra" align="center" hidden="true">
              <xul:image class="ac-result-type-tag"/>
              <xul:label class="ac-normal-text ac-comment" xbl:inherits="selected" value=":"/>
              <xul:description anonid="extra" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:image anonid="type-image" class="ac-type-icon"/>
          </xul:hbox>
          <xul:hbox align="center" class="ac-url-box">
            <!--
            <xul:spacer class="ac-site-icon"/>
            <xul:image class="ac-action-icon"/>
            -->
            <xul:spacer class="cliqz-left-separator" anonid="url-type"/>

            <xul:hbox anonid="url-box" class="ac-url" flex="1"
                      onunderflow="_doUnderflow('_url');"
                      onoverflow="_doOverflow('_url');">
              <xul:description anonid="url" class="ac-normal-text ac-url-text"
                               xbl:inherits="selected type"/>
              <xul:description anonid="cliqz-url-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
              <xul:spacer class="cliqz-separator-10"/>
              <xul:description anonid="action" class="ac-normal-text ac-action-text"
                               xbl:inherits="selected type"/>
            </xul:hbox>
            <xul:label anonid="url-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-url-text"/>
            <xul:spacer class="ac-type-icon"/>
          </xul:hbox>
        </xul:vbox>
        <xul:vbox hidden="true">
          <xul:hbox class="cliqz-ac-logo-icon" anonid="logo">
          </xul:hbox>
        </xul:vbox>
      </xul:hbox>
    </content>
  </binding>
  <binding id="autocomplete-richlistitem-cliqz-leftlogo" extends="chrome://cliqz/content/components.xml#autocomplete-richlistitem-cliqz">
    <content>
      <xul:hbox>
        <xul:vbox>
          <xul:hbox class="cliqz-ac-source-icon" anonid="source">
          </xul:hbox>
        </xul:vbox>
        <xul:vbox>
          <xul:hbox class="cliqz-ac-logo-icon" anonid="logo">
          </xul:hbox>
        </xul:vbox>
        <xul:stack>
          <xul:hbox class="cliqz-image-box">
            <xul:image anonid="cliqz-image" />
          </xul:hbox>
          <xul:hbox right="0" bottom="0" class="hidden">
            <xul:description anonid="cliqz-image-desc" class="cliqz-image-desc" />
          </xul:hbox>
        </xul:stack>
        <xul:vbox flex="1">
          <xul:hbox align="center" class="ac-title-box" >
            <!--
            <xul:image xbl:inherits="src=image" class="ac-site-icon"/>
            -->
            <xul:spacer class="cliqz-left-separator"/>
            <xul:description anonid="cliqz-title-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
            <xul:hbox anonid="title-box" class="ac-title" flex="1"
                      onunderflow="_doUnderflow('_title');"
                      onoverflow="_doOverflow('_title');">
              <xul:description anonid="title" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:label anonid="title-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-comment"/>
            <xul:hbox anonid="extra-box" class="ac-extra" align="center" hidden="true">
              <xul:image class="ac-result-type-tag"/>
              <xul:label class="ac-normal-text ac-comment" xbl:inherits="selected" value=":"/>
              <xul:description anonid="extra" class="ac-normal-text ac-comment" xbl:inherits="selected"/>
            </xul:hbox>
            <xul:image anonid="type-image" class="ac-type-icon"/>
          </xul:hbox>
          <xul:hbox align="center" class="ac-url-box">
            <!--
            <xul:spacer class="ac-site-icon"/>
            <xul:image class="ac-action-icon"/>
            -->
            <xul:spacer class="cliqz-left-separator" anonid="url-type"/>

            <xul:hbox anonid="url-box" class="ac-url" flex="1"
                      onunderflow="_doUnderflow('_url');"
                      onoverflow="_doOverflow('_url');">
              <xul:description anonid="url" class="ac-normal-text ac-url-text"
                               xbl:inherits="selected type"/>
              <xul:description anonid="cliqz-url-details" xbl:inherits="selected type"
                             class='cliqz-url-box'/>
              <xul:spacer class="cliqz-separator-10"/>
              <xul:description anonid="action" class="ac-normal-text ac-action-text"
                               xbl:inherits="selected type"/>
            </xul:hbox>
            <xul:label anonid="url-overflow-ellipsis" xbl:inherits="selected"
                       class="ac-ellipsis-after ac-url-text"/>
            <xul:spacer class="ac-type-icon"/>
          </xul:hbox>
        </xul:vbox>
      </xul:hbox>
    </content>
  </binding>
</bindings>
